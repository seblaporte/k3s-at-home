blueprint:
  name: RFID Card → Music Assistant (Track Selector)
  description: >
    Carte RFID individuelle.
    Sélection d’un média via le navigateur Music Assistant.

  domain: automation

  input:
    tag_id:
      name: Tag RFID
      selector:
        text:

    media_content:
      name: Lecteur et média associé (Track / Album / Playlist)
      selector:
        media:

mode: restart

trigger:
  - platform: tag
    tag_id: !input tag_id

variables:
  reader_id: "{{ trigger.event.data.device_id }}"
  salon_reader: "{{ states('input_text.lecteur_rfid_salon') }}"
  etage_reader: "{{ states('input_text.lecteur_rfid_etage') }}"

  selected_tag: !input tag_id
  selected_media: !input media_content

  target_player: >
    {% if reader_id == salon_reader %}
      media_player.chromecast_hi_fi_2
    {% elif reader_id == etage_reader %}
      media_player.google_nest_palier_2
    {% else %}
      none
    {% endif %}

condition:
  - condition: template
    value_template: >
      {{ target_player != 'none' }}

action:
  - service: media_player.play_media
    target:
      entity_id: "{{ target_player }}"
    data:
      media_content_id: "{{ selected_media.media_content_id }}"
      media_content_type: "{{ selected_media.media_content_type }}"
